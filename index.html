<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <title>ImJoy Reveal.js</title>

  <link rel="stylesheet" href="assets/reveal.js/reset.css" />
  <link rel="stylesheet" href="assets/reveal.js/reveal.css" />


  <!-- Theme used for syntax highlighted code -->
  <link rel="stylesheet" href="assets/reveal.js/plugin/highlight/monokai.css" id="highlight-theme" />
  <style>
    .reveal h1, .reveal h2, .reveal h3, .reveal h4, .reveal h5, .reveal h6 {
      text-transform: none!important;
    }
  </style>
</head>

<body>
  <div class="reveal" style="z-index: 0">
    <div class="slides">
      <section data-markdown data-separator="-----" data-separator-vertical="---">
        <textarea data-template id="markdown-slide-content">
            # ImJoy
          </textarea>
      </section>
    </div>
  </div>
  <div id="window-container" style="z-index: 100"></div>
  <div id="menu-container" style="z-index: 200"></div>
  <script src="assets/reveal.js/reveal.js"></script>
  <script src="assets/reveal.js/plugin/notes/notes.js"></script>
  <script src="assets/reveal.js/plugin/markdown/markdown.js"></script>
  <script src="assets/reveal.js/plugin/highlight/highlight.js"></script>
  <script src="assets/reveal.js/plugin/zoom/zoom.js"></script>
  <script src="assets/utils.js"></script>
  <script src="https://lib.imjoy.io/imjoy-loader.js"></script>
  <script>
    async function startRevealJS() {
      const slides = getUrlParameter('slides')
      if (slides) {
        const url = await githubUrlRaw(slides, ".md") || slides;
        const response = await fetch(url)
        const content = await response.text()
        const elm = document.getElementById('markdown-slide-content')
        try {
          runScripts(content)
        } catch (e) {
          console.error(e)
          api.showMessage(`Failed to execute script: ${e}`)
        }
        elm.innerHTML = content
      }
      const theme = getUrlParameter('theme') || 'black'
      try {
        if (theme) {
          if (theme.startsWith('http')) {
            await addCss(theme)
          } else {
            await addCss(`assets/reveal.js/theme/${theme}.css`)
          }
        }
      } catch (e) {
        alert('Failed to load theme: ' + theme)
      }
      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
        hash: true,
        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom],
      });
    }

    loadImJoyBasicApp({
      process_url_query: true,
      show_window_title: false,
      show_progress_bar: true,
      show_empty_window: true,
      menu_style: {
        position: "absolute",
        right: 0,
        top: "4px"
      },
      window_style: {
        width: '100%',
        height: '100%'
      },
      main_container: null,
      menu_container: "menu-container",
      window_manager_container: "window-container",
      imjoy_api: {} // override some imjoy API functions here
    }).then(async app => {
      // get the api object from the root plugin
      const api = app.imjoy.api;
      // if you want to let users to load new plugins, add a menu item
      app.addMenuItem({
        label: "âž• Load Plugin",
        callback() {
          const uri = prompt(
            `Please type a ImJoy plugin URL`,
            "https://github.com/imjoy-team/imjoy-plugins/blob/master/repository/ImageAnnotator.imjoy.html"
          );
          if (uri) app.loadPlugin(uri);
        },
      });
      // expose global variables
      window.api = api;
      window.imjoy = app.imjoy
      window.app = app;
      startRevealJS();
    }).catch(e => {
      console.error(e)
      startRevealJS();
    })
  </script>
</body>

</html>